{% extends 'base.html' %}
{% block content %}
<div class="card p-4 shadow">
    <h4 class="mb-3">Create Chat</h4>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <form method="post">
        {% csrf_token %}
        <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" name="is_group" id="is_group" onchange="toggleGroupFields(this)">
            <label class="form-check-label" for="is_group">Group Chat</label>
        </div>

        <div class="mb-3" id="chat_name_div" style="display: none;">
            <label class="form-label">Chat Name</label>
            <input type="text" class="form-control" name="name">
        </div>

        <div class="mb-3">
            <label class="form-label">Participants</label>
            {% for user in users %}
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="participants" value="{{ user.id }}" id="user_{{ user.id }}">
                    <label class="form-check-label" for="user_{{ user.id }}">{{ user.username }}</label>
                </div>
            {% endfor %}
        </div>

        <button type="submit" class="btn btn-primary w-100">Create</button>
    </form>
</div>

<script>
    function toggleGroupFields(checkbox) {
        const nameDiv = document.getElementById('chat_name_div');
        nameDiv.style.display = checkbox.checked ? 'block' : 'none';

        const checkboxes = document.querySelectorAll('input[name="participants"]');
        checkboxes.forEach(cb => cb.type = checkbox.checked ? 'checkbox' : 'radio');
    }
    window.onload = () => {
        toggleGroupFields(document.getElementById('is_group'));
    }
</script>
{% endblock %}
